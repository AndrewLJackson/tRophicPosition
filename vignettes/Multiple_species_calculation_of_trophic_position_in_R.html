<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Claudio Quezada-Romegialli, Andrew L Jackson &amp; Chris Harrod" />


<title>tRophicPosition: calculating trophic position for multiple species</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">tRophicPosition: calculating trophic position for multiple species</h1>
<h4 class="author"><em>Claudio Quezada-Romegialli, Andrew L Jackson &amp; Chris Harrod</em></h4>
<h4 class="date"><em>May 22 2017</em></h4>



<div id="trophicposition" class="section level1">
<h1>tRophicPosition</h1>
<p><code>tRophicPosition</code>, is an R package incorporating a Bayesian model for the calculation of trophic position using stable isotopes with one or two baselines. As of 2017-05-14, the current version of the package is 0.6.8-9. <code>tRophicPosition</code> uses the powerful approach of Markov Chain Monte Carlo simulations provided by <a href="http://mcmc-jags.sourceforge.net">JAGS</a> and the statistical language <a href="https://www.r-project.org">R</a>. A vignette with basics of the model and a guide to the use of <code>tRophicPosition</code> can be found <a href="https://github.com/clquezada/tRophicPosition-release-and-vignettes/blob/master/A_guide_to_the_use_of_tRophicPosition_2016-06-12.pdf">here</a>. Other vignettes can be browsed with <code>browseVignettes(&quot;tRophicPosition&quot;)</code>.</p>
</div>
<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>In this vignette, we will introduce the new functions we have developed for <code>tRophicPosition</code> in its current version (0.6.8-9). These functions are <code>extractIsotopeData()</code>, <code>jagsBayesianModel()</code> and <code>multiSpeciesTP()</code>. Aditionally, we provide an example to run these calculations in parallel (maximizing efficient use of computing power). Each of these functions accomplish different tasks within the Bayesian estimation of trophic position with stable isotopes, extracting stable isotope data for multiple species and/or communities, and facilitating the calculation of trophic position for multiple consumers within one or more ecosystems. We have also included a parallel calculation of trophic position, to make full use of the multiple processor cores typical in modern computers.</p>
<div id="installing-and-loading-the-package" class="section level2">
<h2>Installing and loading the package</h2>
<div id="stable-version---cran" class="section level3">
<h3>Stable version - CRAN</h3>
<p>Coming soon.</p>
</div>
<div id="development-version---github" class="section level3">
<h3>Development version - GitHub</h3>
<p>If you want to install the development version of <code>tRophicPosition</code>, you must install it from GitHub. For this, we use the function <code>install_github()</code> from the package <code>devtools</code> (installation instructions <a href="https://github.com/hadley/devtools#updating-to-the-latest-version-of-devtools">here</a>), which needs to be installed previously (either from <a href="https://CRAN.R-project.org/package=devtools">CRAN</a> or <a href="https://github.com/hadley/devtools">GitHub</a>):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">&quot;devtools&quot;</span>)
<span class="kw">library</span>(devtools)</code></pre></div>
<p>If you are working in Windows, <code>devtools</code> also requires <a href="http://bit.ly/2smGeVQ">Rtools</a>, or if you are working on a Mac, <a href="https://developer.apple.com/xcode/">Xcode</a> (from Apple Store). In Linux you will need to install a compiler and various development libraries.</p>
<p>Besides installing <code>devtools</code>, you must also install <a href="http://mcmc-jags.sourceforge.net/">JAGS</a> (Just Another Gibbs Sampler), which is at the core of the Bayesian model analysis supporting <code>tRophicPosition</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install_github</span>(<span class="st">&quot;clquezada/tRophicPosition&quot;</span>, <span class="dt">build_vignettes =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p>After installing <code>tRophicPosition</code>, it should be loaded into memory, which automatically reports the version of the software (we need at least 0.6.8-8 to use the routines described in this vignette).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tRophicPosition)</code></pre></div>
</div>
</div>
<div id="future-releases-and-how-to-get-support" class="section level2">
<h2>Future releases and how to get support</h2>
<p>You are encouraged to use <code>tRophicPosition</code> with your own data, test the package and see if there are any issues or problems. You can send your questions or commentaries to the google group <a href="https://groups.google.com/d/forum/trophicposition-support">tRophicPosition-support</a> or directly to the email <a href="mailto:trophicposition-support@googlegroups.com">trophicposition-support@googlegroups.com</a>. You can send your questions to <a href="http://stackexchange.com/" class="uri">http://stackexchange.com/</a> <a href="http://stackoverflow.com/" class="uri">http://stackoverflow.com/</a> or even <a href="https://www.facebook.com/groups/stableisotopes/">Facebook (stable isotope ecology group)</a>.</p>
<p>We are constantly working on future releases of <code>tRophicPosition</code>, so feedback is very much appreciated.</p>
</div>
</div>
<div id="multiple-species-calculation-of-trophic-position-tp" class="section level1">
<h1>Multiple species calculation of trophic position (TP)</h1>
<div id="before-we-start" class="section level2">
<h2>Before we start</h2>
<p>If you have been using R prior to starting your analysis of trophic Position, it is possible that the environment contains unwanted data. Try to be as organized as possible with the data generated within R/RStudio, as this will make things a lot clearer.</p>
<p>When working on your analysis, a good first thing to do is to set the working directory to a convenient location. This is accomplished using <code>setwd()</code>. In RStudio you can use the menu “Session/Set Working Directory” to make things easier.</p>
<p>The next thing is to clear the environment. With RStudio you can click on the little broom icon in the environment tab, or use the command <code>rm(list = ls())</code>. Also, it is a good idea to clear the plots using the same broom icon in the plots tab, or the command <code>graphics.off()</code>. This is only needed if you have been working with some data before.</p>
</div>
<div id="and-now-an-initial-analysis---bilagay-tp-from-multiple-coastal-kelp-forests-in-n-chile" class="section level2">
<h2>And now, an initial analysis - Bilagay TP from multiple coastal kelp forests in N Chile</h2>
<p>We will start with some data from a fish common to the coastal kelp forests of N Chile, the bilagay <em>Cheilodactylus variegatus</em> (<a href="http://www.fishbase.se/summary/Cheilodactylus-variegatus.html" class="uri">http://www.fishbase.se/summary/Cheilodactylus-variegatus.html</a>). We have data from a number of populations (and associated filter feeding and grazing molluscs representing pelagic and benthic baselines respectively) from a series of different locations along the N Chilean coast. We know from the literature that bilagay diet is extremely variable and reflects what is locally available. We also know that there is a marked <span class="math inline">\(\delta^{15}\)</span>N-enrichment at the base of the food chain reflecting increased upwelling intensity as you move northwards up the coast. As such, we need to account for variation in baseline <span class="math inline">\(\delta^{15}\)</span>N variation before calculating TP at each site.</p>
<p>So, our question is, given the potential influences of local differences in diet stomach contents and upwelling intensity, are there measurable differences in bilagay TP between the different locations along the S-N latitudinal gradient?</p>
<p>We will use a data set included within <code>tRophicPosition</code>. The structure of the file has 7 columns, where species (<code>Spp</code>) are grouped into functional groups (<code>FG</code>) to describe its role in each of the ecosystems: “Bilagay” (our fish of interest), “Benthic_BL” (benthic baseline) and “Pelagic_BL” (pelagic baseline). We have samples from locations along the N Chilean coast (<code>NS</code> stands for the N-S ordering) and from multiple studies (<code>Study</code>) and locations (<code>Location</code>). We also have stable isotope values in two columns: “d13C” and “d15N”.</p>
<table>
<caption>Structure of the file Bilagay_for_tRophicPosition.csv</caption>
<thead>
<tr class="header">
<th></th>
<th align="left">Study</th>
<th align="left">Location</th>
<th align="left">Spp</th>
<th align="left">FG</th>
<th align="right">d13C</th>
<th align="right">d15N</th>
<th align="right">NS</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td align="left">MEL</td>
<td align="left">CHI</td>
<td align="left">Echinolittorina peruviana</td>
<td align="left">Benthic_BL</td>
<td align="right">-10.1</td>
<td align="right">16.3</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td>2</td>
<td align="left">MEL</td>
<td align="left">CHI</td>
<td align="left">Echinolittorina peruviana</td>
<td align="left">Benthic_BL</td>
<td align="right">-11.7</td>
<td align="right">16.3</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td>3</td>
<td align="left">MEL</td>
<td align="left">CHI</td>
<td align="left">Echinolittorina peruviana</td>
<td align="left">Benthic_BL</td>
<td align="right">-9.8</td>
<td align="right">16.4</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td>130</td>
<td align="left">MEL</td>
<td align="left">COL</td>
<td align="left">Bilagay</td>
<td align="left">Bilagay</td>
<td align="right">-15.2</td>
<td align="right">20.9</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td>131</td>
<td align="left">MEL</td>
<td align="left">COL</td>
<td align="left">Bilagay</td>
<td align="left">Bilagay</td>
<td align="right">-15.4</td>
<td align="right">21.3</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td>132</td>
<td align="left">MEL</td>
<td align="left">COL</td>
<td align="left">Bilagay</td>
<td align="left">Bilagay</td>
<td align="right">-15.2</td>
<td align="right">21.6</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td>133</td>
<td align="left">MEL</td>
<td align="left">COL</td>
<td align="left">Bilagay</td>
<td align="left">Bilagay</td>
<td align="right">-15.0</td>
<td align="right">22.0</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td>660</td>
<td align="left">MEL</td>
<td align="left">MEJ</td>
<td align="left">Perumytilus purpuratus</td>
<td align="left">Pelagic_BL</td>
<td align="right">-15.9</td>
<td align="right">18.1</td>
<td align="right">9</td>
</tr>
<tr class="odd">
<td>661</td>
<td align="left">MEL</td>
<td align="left">MEJ</td>
<td align="left">Perumytilus purpuratus</td>
<td align="left">Pelagic_BL</td>
<td align="right">-15.6</td>
<td align="right">17.4</td>
<td align="right">9</td>
</tr>
</tbody>
</table>
<p>If you want to edit the raw data or modify it, open the following file with your favourite application, save it to your working directory and then load it with <code>read.csv()</code> or <code>read.table()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">system.file</span>(<span class="st">&quot;extdata&quot;</span>, <span class="st">&quot;Bilagay_for_tRophicPosition.csv&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;tRophicPosition&quot;</span>)</code></pre></div>
<pre><code>## [1] &quot;D:/Dropbox (HarrodLab)/GitHub/tRophicPosition/inst/extdata/Bilagay_for_tRophicPosition.csv&quot;</code></pre>
<p>To load the <code>Bilagay</code> data set into R, use <code>data()</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(<span class="st">&quot;Bilagay&quot;</span>)</code></pre></div>
<p>As shown above, in this data set we have a combination of Study and Location variables, which need to be concatenated. Here we introduce <code>mutate</code> and <code>arrange</code> functions from the package dplyr and the pipe operator <code>%&gt;%</code> (from magrittr but loaded through dplyr).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># install.packages(dplyr) if you haven't installed it before</span>
<span class="kw">library</span>(dplyr)
Bilagay &lt;-<span class="st"> </span>Bilagay %&gt;%<span class="st"> </span><span class="kw">mutate</span>(<span class="dt">Community =</span> <span class="kw">paste</span>(Study,<span class="st">&quot;-&quot;</span>, Location, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>))</code></pre></div>
<p>Also, this spreadsheet has information from the latitudinal arrangement of sampling sites, which is the variable <code>NS</code> (North to South order), ranging from 1 (most southern site) to 10 (most northern site). Below we order the whole data frame considering those values.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Bilagay &lt;-<span class="st"> </span>Bilagay %&gt;%<span class="st"> </span><span class="kw">arrange</span>(NS)</code></pre></div>
<p>Now, we are ready to proceed with the calculation of trophic position. This follows the same general process you have already encountered in the previous vignette (<a href="https://github.com/clquezada/tRophicPosition-release-and-vignettes/blob/master/A_guide_to_the_use_of_tRophicPosition_2016-06-12.pdf">A guide to the use of tRophicPosition</a>. First we must consecutively subset the data frame considering each of the communities we have samples of. We could use the subset command, repeating the same command each time for each community.</p>
<p>If we only have 2 sampling sites, this can be done by hand. However, here we have different 10 sampling sites, so this task can be prone to errors and time-consuming, as we have to repeat the same code 10 times, but with changes in the Location, selecting the baseline, etc.</p>
<p>To deal with this issue, we have developed a convenient function <code>extractIsotopeData()</code> where you can indicate the text for each of the baselines and the respective column where they are coded, the species column, and the community column. This function iterates through the data frame selecting unique values from the community column, extracting all the values that belong to each community and then iterate through them. Then it will extract all stable isotope values from the columns “d13C” and “d15N” (if their values haven’t changed) for each baseline. Finally, it will select each unique value from the species column and it generates an <code>isotopeData</code> class object for each consumer combining their baselines isotope values. See <code>help(extractIsotopeData)</code> for other options.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">BilagayList &lt;-<span class="st"> </span><span class="kw">extractIsotopeData</span>(Bilagay, <span class="dt">b1 =</span> <span class="st">&quot;Pelagic_BL&quot;</span>, <span class="dt">b2 =</span> <span class="st">&quot;Benthic_BL&quot;</span>,
                                  <span class="dt">baselineColumn =</span> <span class="st">&quot;FG&quot;</span>, <span class="dt">speciesColumn =</span> <span class="st">&quot;Spp&quot;</span>,
                                  <span class="dt">communityColumn =</span> <span class="st">&quot;Community&quot;</span>,
                                  <span class="dt">d13C =</span> <span class="st">&quot;d13C&quot;</span>, <span class="dt">d15N =</span> <span class="st">&quot;d15N&quot;</span>)</code></pre></div>
<p>If no <span class="math inline">\(\Delta\)</span>N and/or <span class="math inline">\(\Delta\)</span>C values are included as arguments, by default this function will use assumptions from Post (2002), i.e. 3.4 <span class="math inline">\(\pm\)</span> 0.98 sd for nitrogen and 0.39 <span class="math inline">\(\pm\)</span> 1.3 sd for carbon). You can change either TDF values using the function <code>TDF()</code> or a list of values, as explained in the short guide to the use of tRophicPosition vignette.</p>
<p>The next step is use the <code>str</code> function to check that all went well during the use of the <code>extractIsotopeData()</code> function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(BilagayList)</code></pre></div>
<pre><code>## List of 1
##  $ MEC-Coquimbo-Bilagay:List of 8
##   ..$ dNb1  : num [1:15] 13.8 14.3 14.2 13.4 13.8 13.3 14.6 14 14.2 13.9 ...
##   ..$ dCb1  : num [1:15] -17.3 -17.6 -17.4 -16.6 -17 -16.9 -18.5 -18.1 -17.5 -18.3 ...
##   ..$ dNb2  : num [1:28] 14.9 15.2 15 15.2 16.3 15.7 15.4 15.5 16.4 15.4 ...
##   ..$ dCb2  : num [1:28] -11.1 -11.9 -11.7 -11.5 -14.6 -13.8 -14.5 -14.3 -14.6 -13.9 ...
##   ..$ deltaN: num [1:56] 4.15 5.27 3.15 5.29 1.49 ...
##   ..$ deltaC: num [1:107] 1.4195 2.99 0.0391 3.0072 -2.2795 ...
##   ..$ dNc   : num [1:10] 19.4 19 19.1 18.3 19.8 20.1 19.6 20.3 19.5 19.9
##   ..$ dCc   : num [1:10] -16.2 -16.7 -17.8 -16.5 -16.8 -17.8 -16.3 -15.5 -16.3 -16
##   ..- attr(*, &quot;class&quot;)= chr &quot;isotopeData&quot;
##   ..- attr(*, &quot;consumer&quot;)= chr &quot;Bilagay&quot;
##   ..- attr(*, &quot;baseline1&quot;)= chr &quot;Pelagic_BL&quot;
##   ..- attr(*, &quot;baseline2&quot;)= chr &quot;Benthic_BL&quot;
##   ..- attr(*, &quot;community&quot;)= chr &quot;MEC-Coquimbo&quot;</code></pre>
<p>If you execute the code above you will see a lot of information, but for this vignette, we have shortened the output to make it readable. In your console, you will note that there is a list of 10 elements, followed by the sign $ and the concatenated name of each of our communities with the name of our species (Bilagay). Each of these objects (MEC-Coquimbo-Bilagay, MEC-Taltal-Bilagay, etc.) is a list of 8 elements that relate to a particular sampling location, in a structure that is ready to use with <code>tRophicPosition</code>: they are objects of the class <code>isotopeData</code>.</p>
<p>The class <code>isotopeData</code> is a special object recognized within the package. It also has other information embedded within it: consumer, baseline 1, baseline 2, and community labels, besides a list of isotope values with the convention introduced before (dNb1 is d15N of baseline 1, dCb1 is d13C of baseline 1, dNb2 and dCb2 respectively for the baseline 2, dNc and dCc respectively for the consumer, and deltaN and deltaC are trophic discrimination factors).</p>
<p>Now, as we have extracted each community from the original data frame, we can iterate through them, prepare a summary and plot them. Here we introduce the <code>for</code> command, which is one of the basic control-flow elements of programming. Again, if you execute the following code you will have a summary and a plot for each community, but in this vignette, you will see only one example.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">for (community in BilagayList) {
  <span class="kw">print</span>(<span class="kw">summary</span>(community))
  <span class="kw">plot</span>(community)
  }</code></pre></div>
<pre><code>## 
## Summary for stable isotope data object 
## 
## Community  MEC-Coquimbo 
## Consumer  Bilagay 
## Baseline 1  Pelagic_BL 
## Baseline 2  Benthic_BL 
## 
##        n   mean  sd  se  min   max   median
## dNb1   15  13.7  0.7 0.2 12.1  14.6  13.8  
## dCb1   15  -17.5 0.6 0.1 -18.5 -16.6 -17.5 
## dNb2   28  15.4  0.5 0.1 14.6  16.4  15.3  
## dCb2   28  -13.3 1.2 0.2 -15.1 -11.1 -13.8 
## deltaN 56  3.4   1   0.1 1.5   5.4   3.4   
## deltaC 107 0.4   1.3 0.1 -3.2  3.2   0.4   
## dNc    10  19.5  0.6 0.2 18.3  20.3  19.6  
## dCc    10  -16.6 0.7 0.2 -17.8 -15.5 -16.4</code></pre>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAqAAAAHgCAMAAABNUi8GAAABL1BMVEUAAAAAADoAAGYAOmYAOpAAZmYAZpAAZrYAujgzMzM6AAA6ADo6AGY6OpA6ZrY6kJA6kNtEpcRKpkhLslVMz3NNTU1NTW5NTY5NbqtNjshao8xbq9VhnP9mAABmADpmAGZmOgBmOjpmOpBmZgBmZmZmZrZmkJBmtrZmtttmtv9uTU1uTW5uTY5ubo5ubqtuq+SOTU2OTW6OTY6Obk2ObquOkdOOyP+PneGQOgCQOjqQOmaQZgCQkGaQkLaQkNuQtpCQuv+Q27aQ2/+rbk2rbm6rbo6rjk2ryKur5OSr5P+2ZgC2Zjq2kDq225C2/9u2///Ijk3I///bkDrbkGbbkJDb///kq27k///r6+v4dm36n5n/tmb/trb/yI7/25D/5Kv//7b//8j//9v//+T////zfOWIAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAevUlEQVR4nO3dC3vcxnUG4KWilrQst4xjSnaztFqntUvbtWS3UWinTZV1WlebtpQ2oSSK5VX4/7+hg+viMgPMDOZyZub7HlnmgnsWWOLVwQALgIsMQQhn4XsBEGQsAIqQDoAipAOgCOkAKEI6AMrP7fFiv/jifHH3NFsvyrAvi29VX22f250wzPXhUXfC5b0j/jORbgCUH4auJLcugLb4nRdy1zsr4QSZAKhkAJSf2+O/+DQXd/3oV12glazb43rSYIJUAFQyAMrP7fHuOm+M53d/2wW6qb78vxPehHO2sS+GBpvFYuff318Vm3b2V/7/y3tfHLLvXt5bLPIHn9+rntrUIJwAKD8M6Hkub72/7gBl0wdP3D44Z/SuD9mE9Z0T9mCnB5SNAjYL9p3NnZPiweW9/VYNwguA8sPcXd4/ya4/Xa1bO0n7jFKv2bUn3B4XTXdnVW7AN32g+1n911Hx/1xqU+PwzYUUAOWHAb09PmJb+NNuBx0FWrpkf5/fybf3l/1N/FHW/FU+tbGMIakoAMpPvuXe7LItfKawiS+ZMYybaaDvr8pnNDVu3ldwAVB+cneX9//3+1UPaLNPxIaOm2Kj35qw7aA7FT900LkBUH5yoLfHn7Nh6Fr+MFMzniwbYjEGLYecHKDFGLRV4/odBhIA5afYcq8X+V+8A/W3x70D9eWEZo98U+yj76xKtgseUPaM/OnYix8PgPJTAC0AtffiC5XXh71PNlsTmmOa+Refs3Fm/r0vuJv4z4vjoRmOg44HQO2l3BFCZgVA7QVADQRA7QVADQRAEdIBUIR0ABQhHQBFSAdAEdIBUIR0ABQhHQBFSAdAEdIBUIR0ABQhHQBFSAdAEdIBUIR0ABQhHQBFSAdAEdIBUIR0ABQhHQBFSAdAEdIBUIR0ABQhnViAnuXxvRCI+cQB9OzsbR4IjS9RAC15QmiMiQFo4xNA40sEQLc+ITS+hA+07RNCo0vwQLs+ITS2AChCOqED7fuE0MgSONChTwCNK2ED5fiE0LgCoAjpRAgUQmNK0ED5PgE0poQMVOATQGNKwEBFPgE0psQIFEIjSrhAxT4BNKJQA7rXZOKJIz4hNKLQArq391GTCaIAmkYoAW3znCQ6ChRCowkdoH2eBVHhs8d9Amg0IQOUw3NM6ARQCI0lRIDy2ufYZn7KJ4DGEhpARTyFTRRAUwkFoML2KRQ66RNCYwkBoOM8ATTt+Ac60T95QiV8Amgk8Q10mudQqIxPAI0knoHK8BwIBdCE4heopM+eUCmgEBpHfAKV2rxzhAJoQvEHVIVnR6icTwiNI76AKvIEUFehdh9gL0D3lHm2gMr6BFCNnJ31blV9eW/BcpRd3j9hfzwskQegGjrbQqWBQqh6hkBzlZfvr+ovncc5UJ3u2RYq7xNAlXN21hdaqLz9flV10LyhHmXZ9eHiZ3+3qh6tWX/94NTWIrkFqq+zEaoAFEIVcjZIMbnsoB+clkCvP10VU9b72fnOqnp0zh7sW1sup0Bn8SyFqvgEUNVwOmgxBr17uh2DXj86YX/yrlo/+uz0jytri+QQ6FyeAGo//DHo7fFRDXS9WNw5ybfoBdDi0e33v//M2hbeIdDZPAuhSkAhVDV8oGyYWW3iD4v9+aqDVo+yzd/b28K7A2rC50d7aj4BVD2946AFUDbYLIEW+0lsl74cg9aPyp18S3EF1IhPJhRA3aZ3HHSzWPzsb4/yvfi/ZJv46tHtDxaPP7kBOn/4WeZDAKWS1lHRy7+yOB8nQA3xZEB/oSYUQK3k9nix2Gk265sdi1t4J0CN+WRAITSxOABqzieAppeggDKfEJpY7AM120BVhdoFumSxOgPEOlCDPnWAWhK6LPOMpfrSymwQ60DFPj/Mo+HTfwutZHYDo3ZiGeiIz5yamlAtoKaFcnXCqLXYBTrhMyeq7tNnCxXrrI2anBviDegWm7xQTaAGhU7xBFHzsQpUwqe80HaNlxYqwxNETccm0OkNvIrQTo17obI8QdRsLAKV9CkJtFvjGqgKz7CJTv9+FbexB1TWpxZQJaGzgaryDJfo4FcAlafbNSckD67s7E9onZ5nZomsAZX2KSm0X+VQqAbPUIUOgVYnLLcfjqW+TBlA3W3kdfpnoESHv0WtviYpP0f5zkk2uPQ4n8C+2ukILi9TNrNItoCOfMI5AColdBbQGUK1eQZGdG+QYnJz44b1frbZzQaXHrOvcr7nd6vL5lqXKZtZLvdAhz5lhA6rnAidxTMsoXk4HbQaU+Ysrx8NLz3u3xKndZmymUWyBFSpgeoBdSF0rs/giPLHoFmxQc/Poh9cepwDbd9WpHWZspklsgNU0ee0UG6V9WHofJ5miS47MfWq7YiBPjqpHnYvPR500O1lymaWyArQsVPsfAF9q3xbQQPt05zQ5uy+1qtaUdo7DtpAy4eczQ1GOpce52PQ5mmty5TNLI9roHyfU0IFVarXeKoQNcbTAFHxGVTWz0RtoJW76oNLjwd78fVx0OL/u/MXwAZQDZ8TQkVlikLfKtyd1aTPZzNOxRt0TnMvPTsubshoAaj6Bn4KqLBKFWhpVAKp0f5ZO9L4Wcothw+i3UuPq465MH8FslugYp/OgMr0UQs8dYhO9k7PRp3EPFC9BjoGdKRKT+jEcNQOT0WiKjpVXzukGAc6epHcCLURoWNVukJHDjvZ8ynNSFln9doRGjUNdPwizjFqQqGjRcaFWtq8KzDS01m9uOHV6T+Ggc7wqQnUrFDrPEtGQqPT++zaLx1ozAKd41ModKpMX+iAqBufFaRlf96zddYvbXSdeg59oFNVM4T2mqg7nrWkTky+sNG16jUOgU5L4wq1CbQt1DVPq4mHqEmg47epnYbGFSpTZqKFxsQzTyxEDQKduAuTHlCZKgNCo2qfVeIgag6oAZ/aQGcKjZFnnhh26Y0BnbqLnZy0vlBJn7OEnkXKs4iyUGqoTQGdvMuiJLUPdYrmCGUr5Ne+FdmMGrjBudD16XPdbE9TDuayYzMNtC9UBaiW0OXyN7/5TdRAn6meAdADuv1tx1lnqkAg0cuOJ3/NjIK01i0ZFap+odNDl4XP+IVKt9Hh5ST1ZcT1Zccf/Jb1x/zr/7n/q7pT0r/s2NT2vRJaF6n5VG2itc4khE630eUgxeT6MuL6suN7zZUfzVfkLzue/i1ditKKOy8r8yyIqm3bt/l1EkQn+ying1aXEbcuO279VsTmq8HzSQE17LM0qsFTuocuezwTaaLPprf1/DEo65Gty44HQKlfdmxw/Dk/00R5OhPpoUVGhfKBZuuj7WXHEx2U4GXHU0fonQIdJ7oU6Eyoh04dGe312ObmYc1lxwOg5C87Hv8E3jFPIdHlKM6qiaZgVO04fHMcdHvZcWGS7cXXQMlfdjx2kZwHniXRFtKlhM2EuiitD4omYxFo/nuQ/PjMsz1cIkdz20UjR2oHKOXLjvtAP6zi2GE/f8Py81bUkJbxjclG0uugCGIvAIqQDoAipAOgCOkAKEI6AIqQDoAipAOgCOnoA30PCTIG8bjIDKBqT3+jNRNUma4CUEFCW5GxVtWrbXnWitbrugmAJlbVAG2fi0iYKIAmVsUFauBXltsKgCZWJQCq8ht6nAZAE6sSAX0r+xt6HAdAE6saAUqykQJoYlUTQMk1UgBNrGoaKC2kiQEd+7nTWELbVXJA6SBNC+joUWkSS2i9Sh5ojdSv0qSAjn9uQmEJ7VepAa2Uas3XTADU0ryoVmkA9dpIAdTSvKhWaQFtlGotwKwkBRRj0DlA/bRSD0BV3iL24k1XzQPqvpW6B6r0jzC01U+/ygBQp63UOVC1MxBDW/30qwwBddZKJYFefXlw8DTLbp4cfPy6muQJqMw5tqGhcVllEmiJVGuhpCMH9Obb59nVV8/f/fg0e/VJNc1jB52qDg2NyyrTQG33UTmgF7nKF09vvnuZXX39spzmcQwKoPpV5oHaRSo/BmVd9Oqb10UzLS/pfKMZ9l50S+tXsD2DiGMHqD2k0kDf/fg4u/i4Bpp5PQ46/nPQ3cEMrRfqVdkDWiHVWkZxZIHePHnMdpW+CQCo9oWKoVHTq7IL1LxR6b14tg+fGRmDala13zeA6ldZB2rYqBzQ0mexmZ+7F69Z1UEHoPpVLoC+NXiVqBzQVwd5npo4DqpX1VWHMah+lSOgxrpoICeLqABV+rCfM6+4q1wBfWvoGH6MQIND47LKIVAjRAMBqjAGnT+vqKucAjVANBSgY3vxg016aGhcVjkGOltoMEDb6b7n4U5RaGhcVrkGOldo+EA5h5VCQ+OyyjnQmUecQgTa5QigSlXugc4TSgvo4K1wqpjFs6w9IBUDVfvJhEZNrwpABTEHtP7TTBCOQQF0WOVhE58W0LPWf+UEdFCVKoxBBZEDajjmlzD4Kvd78VoL3YQY0OkqUQdte0QHFVfhQL0gxlYJfwzaERoaGpdVboHO/6wzQKC9vfi2UNPzirDK7WfxWgvcSXhAuWcrAahsFc5mEsTeR53lJN4Y1MS8YqvC+aCCWAbaaauhoXFZ5QaouWs+ogFqa16xVTkAaqp5FgHQxKpsAzWqMwv09osAql9lFahpnVmgt18EUP0qa0CVP7mTS5C3XwRQ/SpbQG3dPywsoFUhgOpX2QBqqXkWCQpoXQmg+lXm7w9q9w6hIY1BG9sAql9lFKhlnHlmANW9AeCZ7t0RK6CTt19ERmIMqO3WWSWk46DooAaqjAB1hDNPSEAxBjVQNRuoQ5x5ggLKOznZ2rwirZoJ1PkvmwsLKKpmV80A6rh3lgHQxKo0gXrBmQdAE6vSAeoLZx4ATaxKGahPnRmAJlelBtSzzgxAk6tSAOpfZwagyVXJAyWgMwPQ5KpkgVLonnkANLEqOaBUeAJoclUyQOnwBNDkqiSAUvIJoKlVTQMl5RNAU6uSAKo1F1sB0MSqJoHSaqAAmlrVNFCtmVhLsEDHPuYIDY3LKgAVxPAqGT1pOTQ0LqsAVBCzq2T8tPrQ0LismgJKzCeAplYFoIIAKI2qCaDE9uGDBYoxqG7VOFByPoMFir14zaoJoFpzsJlggaJKr2oUKD2fAJpa1RhQgj7lgV59/ZL99eXBw5fVBAANskoMlN74M48s0Itc5s23z7NXH78upwBokFVCoCR5SgN98eAn1kGvvnmd3XxXtVAADbJKAJRm+8wUN/HbDvoei+8bCSI64QIly1N1DHrz5KDewqODhlnFB6r1wk6iBPTqq+fZxUNs4kOu4gAl3D8VgV6w9plv5osAaJBVA6CkeaKDJlfVB0rcp+IY9OLg4EHVQAE0zKoeUOI88UlSclUdoNTbZwagyVW1gQbgE0BTq2oBDcEngKZW1Qaq9XKOA6CJVW2BBtFAATS1qhZQrVdzHQBNrKoBGoZPAE2tCkAFCW1FxloFoIKEtiJjrWqAar2W+wBoYlUAKkhoKzLWKgAVJLQVGWsVgAoS2oqMtQpABQltRcZaBaCChLYiY60CUEFCW5GxVgGoIKGtyFirAFSQ0FZkrFUAKkhoKzLWKgAVJLQVGWtV8EA3iyL7k5UAGmRV2ECvD2uZm8XOarwSQIOsChro9aMTwQNOADTIqqCBKgVAg6wCUEFCW5GxVkUA9PaY7SQdTVbi/qBBJgKgm93pAWiGDhpoVQxA2Y785X0AjbOqARqI0BmbeLUZhbYiY62KAKhkADTIqgboszCEooMmVrUFGoZQ7CQlVtUCGoTQ7idJh3njxE5SzFVtoCEI7XXQ9WJnhU18zFUdoM/o7yoNNvGM591TmUoADbKqC5Q+0S7Qc9Y7755e3pM42w5Aw6zqA82JUjbaHYN+uiqHoNnmDsagcVYNgdJuo8PT7dYS3TMPgAZZxQVKuI3yNvFylQAaZJUAaGmUIFJ8kpRYlRgozeNOOKM+sapxoPTa6OCapOoAKK5JKjO5vrwvoWLVBFBy49HBJn6NqzpbWU52FN9LqFolAZRUI8UYdKxquZwUGtr7kgNKp5EC6FhV0kBpNFIAHatKHSiBRgqgY1UAWhrVmq+ZAOhYlQBoe1Jo70sHqM8uCqBjVXygnWmhvS8toB6N9k5YXtTBySJFhD6bqb6XULVKF+gzT6eU8DvoGsdBq/A38FygKj0mSKBeiPKAXh9OfYqUJw2gnAiATh/T15iX+apZQD1s6TlAz+VOaEoWKH8MKrHDrzMv41UzgTpvo0Og68Uu74lXX7/Msnc/Hjx4Xk1IFyh3Lz4doG4PO/WB3h7zr5e7OHjIgL54ml18/LqckjBQXlVKQF1u6HtAL+/xd99fPPiJddCb715uJwFotyqNMWjLqNbCKKcLdMPfvOfJN/FX3/xntYl/j8X3jQTdhcmT+P7Us2jEFFBXbVT6OGgB9MunDGlym/jR3vhGsXdOzMt6lTmgz5y0UelPksoO+jq7+bbaS0oG6Pjo8o3i6HN8XvarjAJ1QFQJ6M2/xAm05KUItJokAXQ5fEY0QK0TbYBef3bKtvDiTziLw0wvotzEV3rUgNbTJDto79sRAbVMtA30j6v8b8ETC6A3T4qjTZ13Khm6QGtgSmPQRqXkGDRmoFYPjPaA3v4weZJInXSAjn4g/6b5/vhmfs4SmqyyA9Se0C3Qw90/jXXQQRICOlIkexw0bqAWibZ2ks4Xu8XNmSQTDdCpMehokewnSbEDtUYUJyxnU3vxo0UAapkogBqqWjbhPi0FoFaItsagkmfS99+pZMKhplk1LjQNoBY+/9x20MsPpPePigBor2pUaCpAn5k+5tTaxG+m70vfTppAB/ze9L4LoGZv94AxqFLV0J8c0NEq6QQCtEKqtbCDAKhKFQfgm+ETOGWsg8b6WfyYUQNKOUDz3SX8EoV2mp80Z5i5/SSpfganvv6jvYRLrSrevNwBbZRqLXWdHtDNnZPrw/3qNymMJx2gSw7Q9kVzU61i2fpPcwmDBVoj1Vbau4HtP2TZuthX+jNu3FBnSSHG3pcHoI1SnaXvAf1ddv7Xv8u/AtAmbSLDjbzM+aBZ2h10FtLBr0K8e/qnVZadC69NGrxTyVCgplfVB6gMNOUxKAep2tILfh23xK0bkgE6GGN2HsucD5rmXryYqApSHGaSqFr29tKX4r14QWn/GfpLyJ/X2DoXAP25N6HPVPoogCpVDZvleFXzfFOfJPG79WgPpwhUniiAqlRxhpujVdvnGwLKH++Oj4IFQH/pWajkZ/YAqlI1DZQzWuUA1TvkMjiCMLJYwiVsAfUrVPJHAKAqVZNAe98WAJ3cqxqbuTGgXluo9PsHUKWqiTHoQAp3DDp9XEo4a0Glzhj0lx6FKrx5AFWrGkCYOJupfmQSKGdZxl5ODNSLUMW3DqAmq8T0jAHtTVBdwi5Qx+NQnbcNoEarhKvA1Bi091DmZcaAOhOq95azWUB930iQZJaCezAupZ41/oLdqgqo6rL0gFonqre5MAJU7emh9ULDVbrHQTtrV3I40Ssd7aD2iM6VWQVA3VRpAu2uZcnhRK90EqhZosJDDXoBUPtVnFVmAujE4X4VoKaIGoRZB0BJV3WAqq19NaAziZrtmu0AKO2qrk91oYN5CYHmRJWNGt6ecwKgxKu6PlWFDuc1ArQ0KofUOsw6ABpKlTYJFaCTjdR+y+wFQEOpcgZU0Egdw6wDoMFU6QLRANpB6rpndmMU6N7envDp1Fd/AFXL/uUmOvOSBsriVWYVk0D39kaEkl/9YVRpkNEEyubzUZGRruMgBoHu7Y0JDWL1k6/S2dyqAy3m8dE2o53HcgA0qCrrQPs2vSsF0KCqrAIV2vSpFGPQsKpsjUElcPpRir34wKps7MUr4HSuFMdBE6saAtXQ6VApgCZWNQCqz3OrVGu55OIX6OR7C23106/qAZ3RPt10Uq9Ap99XaKufflUHqBmeVpX6BLrXRKVKb16oqtICapSnLaVkgPLfV2irn37VFqgNn+aV0gC6J9rah7b66Ve1gNryuVWqtbzd+B+DtiNVpTcvVJVpgFr2aQqp9714AHVb5RRoiVRrqet4Pw4KoG6rnAOdeaDUO9AMY1CnVQ1QZz7nGaUBNMNevKsqP0A/0t7USwO9+vpl/r93Pz7tvdPJlPTEQMdqQ1v99Ku8AWVEdZZeFujFwcMC6KsDVaDVxhtAaVR5BKolVBLoiwc/FR306p/+WRFovfsDoDSqfALVEaq2iX/3h/8qN/HvsYze1pKZbL7Yax5wnynzKoipeO2g1oG+eiw5Bt3ulM/poLofmYXW1VxWRbqJL4FeffNaDmj7sKb+GHTqTBJhQkPjsirWnaQC6KuDPI+775SXDi2FvfguRwC1UIXDTHk4tGSA9ooA1EKVJ6D2D9SrHQcdypIA2gcJoBaqfACd81mnrU+SBss08ll860sAtV3lHui8s0VcfNRZLCD/h5t/Cp+1BqsAarvKLVDNwzCt+AZa/ykf9d4PDjOZr3IK1MAZy36B7rX+Kx7nHrsbfZ1FCw2NyypnQOc3zyJOgM6JzqKFhsZllRugZnDmodVBs/7A8w2AGq6yD9RQ66zi+XzQ7hi0mNIFqrVoqBJX2QVqFmce30Dbe/HVFAC1WWUPqHmcebyfUT94V52RZ2irn36VFaDaewvT8X5V5/BkkfZ7FVapz2syaVQZB2rPZhEC18VrVSnPazppVBkGav0eoQTuLOKkSiJpVJkDanG73koAQHtPAdBZVUaAurFZhD7Q/nMAdFbVXKAObRYhPwYdesQYdE7VDKCubRYhuBffreI0TOzFz6jSA+rFZhHvx0E1gOrPC1XqQP3ZLEIeqM45d6GhcVmlCNTvL+rMQgCqcc5daGhcVskD9dw6qwQAVD2oEldJAqVgswiAJlYlA5SMzgxAk6uaBEpJZwagyVVNAKWlMwPQ5KpGgZLj6Rvo3tRRztBWP/2qcaBaM7CaGUB930gQ0ckIUIL903cHRZXzqjGgWi9vOQCaWBWAChLaioy1SgyUpE8ATa0KHVSQ0FZkrFUAKkhoKzLWKgAVJLQVGWsVgAoS2oqMtWrsQD1Foa6Aap6CENrqp18FoNzonvwa2uqnXwWgvOhcWFQktNVPvwpAeQFQMlUJnSyi8FwAJVMFoNxgDEqlCkD5wV48kSoAFSS0FRlrFYAKEtqKjLUKQAUJbUXGWjV6mAlAVYMq01U4DipIaCsy1ioAFSS0FRlrFS6aEyS0FRlrFU63EyS0FRlr1cg1SQCqHlSZrsJFc/zgkyQiVUKgNH3is/jUqkRAifrE2UypVfGB0hx/5pEGevX1S/bXlwcHT6sJABpkFRcoXZ/SQC8OHr7Mbr59nl199bycAqBBVvGA0uUpDfTFg59YB734JP+yaqEYgwZZxQFKuH+qbuJZ8i7K3iaL0l3/mE9L9xNElDIESpmnOtB3Pz6uJuA4aJBVfaCk22emDPTmSe0TQMOs6gGl7lN5L/5pMwFAg6zqAqXOUxFo2yeAhlnVAKXxi+QmowT01UEenb348FZkrFWKq817cLJIYlUAKkhoKzLWKgAVJLQVGWsVgAoS2oqMtSohoEiQMYjHRfSBOonLHyfmRTEAinmRDnGgSOoBUIR0ABQhHQBFSAdAEdIhDXRwgorleRUze/jSzbwunMyqPtG8viAiuFAGelGvwYuPX7uZ1wv7/xDqeRX/+D5xM6/WjzK4EAZaXqiX1ZdBOZjXuz9Yn1HWel8O2lo1r+0sgwthoM0KdNBoynndPHEymmhgunhj2MRbTHUdlP0GWs0rv+bfRRct39fVlw8cvDEAtZEXBwd5cyl/qpZHoJ15ZXbHob15Wf2n150XgNpI+VN98XjyicbmlTnZUfIwLwC1keKn6mbPpZhX3qvf/Yebw0z5vFwMXgDUYoqfqpshaHMc1Nm40OW8ABRB7ARAEdIBUIR0ABQhHQBFSAdAEdIBUIR0ABQhHQBFSAdArx+dZNl6sTjyvSAIL8kDPV/cOcnOd0unCLmkDvT2325/KGQCKM2kDpQRLYCuF/u+FwThBUCrDpptcqGbxWKxs2q+dXx0fcjk3n5fTbr+dMV7CcRekgXK5OWjzxLo+X4B9Pb47mmOtN5f2uyyP5fvry4/OK2mnN89FbweYifJAv3zCTOaN82ig7K9+F32d8lvUynM++V6//rwaNPs4bOe6mdxk02yQLddsQmj2HmcQ82B/uMP2/0ntFDHSRZodnmvb41tzNsPb4/zDT/bxP/rrvA5iO0kC/T60Ukf2+X9zpGmoqGyoeru+ot8T+m82Hvqd1nEclIFWhz2PL/TEdkDW1u8/uy/WRv9PRuK7lZtFXGXVIGe55vtXjtsRJYHk+qHm/18IPr5+6t8/AmgjpMq0GJPvX9Ys9p935SNtQJ6+/2qBRSbeMdJFejlPdYJ17vdib3joOuiWbLd/c12E4+dJMdJFSgTuuB8urluf5JUHlJiTPM9pWonaYPDTG6TLFCJcD7YxIF61wHQkWx2+1NwnN51AHQkg36Jk0WcB0AR0gFQhHQAFCEdAEVIB0AR0gFQhHQAFCEdAEVIB0AR0gFQhHT+H1a9gDuc2DP3AAAAAElFTkSuQmCC" /><!-- --></p>
<p>Now we have to model each community within the Bayesian framework of <code>tRophicPosition</code> (as introduced previously in other vignettes, e.g. <a href="https://github.com/clquezada/tRophicPosition-release-and-vignettes/blob/master/A_guide_to_the_use_of_tRophicPosition_2016-06-12.pdf">a guide to the use of tRophicPosition</a>.</p>
<p>For this, we have developed a function that automatically i) defines a Bayesian model, ii) initializes the model and iii) samples the posterior distribution of trophic position. This is accomplished using the function <code>multiSpeciesTP()</code>, similar to the function <code>multiModelsTP()</code> explained in the vignette multiple models calculation with tRophicPosition.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Bilagay_models &lt;-<span class="st"> </span><span class="kw">multiSpeciesTP</span>(BilagayList, <span class="dt">model =</span> <span class="st">&quot;twoBaselinesFull&quot;</span>,
                                             <span class="dt">n.adapt =</span> <span class="dv">10000</span>, <span class="dt">n.iter =</span> <span class="dv">10000</span>,
                                             <span class="dt">burnin =</span> <span class="dv">10000</span>, <span class="dt">n.chains =</span> <span class="dv">2</span>, <span class="dt">print =</span> <span class="ot">FALSE</span>)</code></pre></div>
<pre><code>## Compiling model graph
##    Resolving undeclared variables
##    Allocating nodes
## Graph information:
##    Observed stochastic nodes: 269
##    Unobserved stochastic nodes: 16
##    Total graph size: 354
## 
## Initializing model</code></pre>
<p>By default, the function <code>multiSpeciesTP()</code> uses <code>lambda = 2</code> (trophic level of baselines), <code>n.chains = 2</code> (number of parallel MCMC simulations), and set n.adapt, n.iter and burnin as 10000 iterations. The model calculated by default is <code>oneBaseline</code>, so in this case we have changed it to <code>model = &quot;twoBaselinesFull&quot;</code> as we have two separate potential sources of N and C. In this particularly case, there was no need to explicitly state the number of adaptive iterations, iterations and burnin, but we decided to make them clear. Also, here we calculate 5 chains instead of the default (i.e. <code>n.chains = 2</code>).</p>
<p>The function <code>multiSpeciesTP()</code> returns 4 objects: 1. a list named <code>multiSpeciesTP</code>, which includes the raw data returned by <code>posteriorTP()</code> for each species per community/sampling location; 2. a data frame named <code>df</code> with the mode, median and credibility confidence interval for trophic position and alpha (if a two baselines model was chosen), grouped by model, species and community/sampling location; 3. a list named <code>TPs</code> with the posterior samples of trophic position for each community/location and species; and 4. a list named <code>Alphas</code> which includes the posterior samples of alpha (relative contribution of baseline 1) for each species by community/location.</p>
<p>More advanced users will likely directly access this object for subsequent analysis. For now, we will concentrate on plotting the mode or median and 95% credibility interval for Bilagay from each location, using the joint values of trophic position and alpha by community/location, allowing an easy visual comparison between them:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># By default the mode is used in both trophic position and alpha plots</span>
<span class="kw">credibilityIntervals</span>(Bilagay_models$df, <span class="dt">x =</span> <span class="st">&quot;community&quot;</span>, <span class="dt">xlab =</span><span class="st">&quot;Community&quot;</span>)

<span class="co"># If you want to use the median instead of the mode,</span>
<span class="co"># just add y1 and y2 as arguments</span>
<span class="kw">credibilityIntervals</span>(Bilagay_models$df, <span class="dt">x =</span> <span class="st">&quot;community&quot;</span>, <span class="dt">xlab =</span><span class="st">&quot;Community&quot;</span>, 
                     <span class="dt">y1 =</span> <span class="st">&quot;median&quot;</span>, <span class="dt">y2 =</span> <span class="st">&quot;alpha.median&quot;</span>)</code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>To get a numerical summary of posterior estimates (median and 95% credibility interval) of trophic position, we can write the following:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># To get a numerical summary</span>
<span class="kw">sapply</span>(Bilagay_models$<span class="st">&quot;TPs&quot;</span>, quantile, <span class="dt">probs =</span> <span class="kw">c</span>(<span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.975</span>)) %&gt;%<span class="st"> </span><span class="kw">round</span>(<span class="dv">3</span>)

<span class="co"># To get the mode</span>
<span class="kw">getPosteriorMode</span>(Bilagay_models$<span class="st">&quot;TPs&quot;</span>)</code></pre></div>
<pre><code>##       MEC.Coquimbo.Bilagay.2bf MEC.Taltal.Bilagay.2bf MEL.COL.Bilagay.2bf
## 2.5%                     3.449                  2.908               3.343
## 50%                      3.670                  3.199               3.477
## 97.5%                    3.885                  3.476               3.646
##       MEL.CHI.Bilagay.2bf MEL.RIN.Bilagay.2bf Fondecyt.ISM.Bilagay.2bf
## 2.5%                3.549               3.410                    3.267
## 50%                 3.704               3.542                    3.480
## 97.5%               3.844               3.691                    3.671
##       MEL.LAG.Bilagay.2bf MEL.LOB.Bilagay.2bf MEL.MEJ.Bilagay.2bf
## 2.5%                3.072               3.265               3.223
## 50%                 3.195               3.384               3.322
## 97.5%               3.316               3.535               3.427
##       MEC.Tocopilla.Bilagay.2bf
## 2.5%                      3.540
## 50%                       3.754
## 97.5%                     4.033</code></pre>
<pre><code>##  MEC.Coquimbo.Bilagay.2bf    MEC.Taltal.Bilagay.2bf 
##                     3.668                     3.186 
##       MEL.COL.Bilagay.2bf       MEL.CHI.Bilagay.2bf 
##                     3.478                     3.704 
##       MEL.RIN.Bilagay.2bf  Fondecyt.ISM.Bilagay.2bf 
##                     3.535                     3.479 
##       MEL.LAG.Bilagay.2bf       MEL.LOB.Bilagay.2bf 
##                     3.182                     3.371 
##       MEL.MEJ.Bilagay.2bf MEC.Tocopilla.Bilagay.2bf 
##                     3.320                     3.753</code></pre>
<p>Finally, we can statistically compare whether either the posterior samples of trophic position and/or alpha alpha differ between communities/locations. In this example we compare both posterior estimates accross communities/locations with the function <code>pairwiseComparisons()</code>. Remember that this output must to be read as: what is the probability that consumer in row Y has a posterior trophic position/alpha less than or equal to consumer in column X. To make readable the output, we will compare only the first 8 communities/locations. If you want to compare all the communities/locations, just remove <code>[1:8]</code> below:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># First, we compare bilagay posterior trophic position estimates</span>
pairwiseTP &lt;-<span class="st"> </span><span class="kw">pairwiseComparisons</span>(Bilagay_models$TPs[<span class="dv">1</span>:<span class="dv">8</span>], <span class="dt">print =</span> <span class="ot">TRUE</span>)

<span class="co"># And then, we compare their posterior alpha estimates</span>
pairwiseAlpha &lt;-<span class="st"> </span><span class="kw">pairwiseComparisons</span>(Bilagay_models$Alphas[<span class="dv">1</span>:<span class="dv">8</span>], <span class="dt">print =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>##                                [1]   [2]   [3]   [4]   [5]   [6]   [7]
## [1] MEC.Coquimbo.Bilagay.2bf 0.000 0.005 0.089 0.604 0.183 0.104 0.000
## [2] MEC.Taltal.Bilagay.2bf   0.995 0.000 0.950 1.000 0.985 0.936 0.495
## [3] MEL.COL.Bilagay.2bf      0.911 0.050 0.000 0.965 0.718 0.470 0.010
## [4] MEL.CHI.Bilagay.2bf      0.396 0.000 0.035 0.000 0.084 0.054 0.000
## [5] MEL.RIN.Bilagay.2bf      0.817 0.015 0.282 0.916 0.000 0.292 0.010
## [6] Fondecyt.ISM.Bilagay.2bf 0.896 0.064 0.530 0.946 0.708 0.000 0.020
## [7] MEL.LAG.Bilagay.2bf      1.000 0.505 0.990 1.000 0.990 0.980 0.000
## [8] MEL.LOB.Bilagay.2bf      0.995 0.129 0.832 1.000 0.931 0.762 0.025
##                                [8]
## [1] MEC.Coquimbo.Bilagay.2bf 0.005
## [2] MEC.Taltal.Bilagay.2bf   0.871
## [3] MEL.COL.Bilagay.2bf      0.168
## [4] MEL.CHI.Bilagay.2bf      0.000
## [5] MEL.RIN.Bilagay.2bf      0.069
## [6] Fondecyt.ISM.Bilagay.2bf 0.238
## [7] MEL.LAG.Bilagay.2bf      0.975
## [8] MEL.LOB.Bilagay.2bf      0.000</code></pre>
<pre><code>##                                [1]   [2]   [3]   [4]   [5]   [6]   [7]
## [1] MEC.Coquimbo.Bilagay.2bf 0.000 0.495 0.797 0.579 0.837 0.015 0.896
## [2] MEC.Taltal.Bilagay.2bf   0.505 0.000 0.827 0.629 0.837 0.015 0.931
## [3] MEL.COL.Bilagay.2bf      0.203 0.173 0.000 0.262 0.545 0.005 0.663
## [4] MEL.CHI.Bilagay.2bf      0.421 0.371 0.738 0.000 0.757 0.015 0.832
## [5] MEL.RIN.Bilagay.2bf      0.163 0.163 0.455 0.243 0.000 0.005 0.653
## [6] Fondecyt.ISM.Bilagay.2bf 0.985 0.985 0.995 0.985 0.995 0.000 0.990
## [7] MEL.LAG.Bilagay.2bf      0.104 0.069 0.337 0.168 0.347 0.010 0.000
## [8] MEL.LOB.Bilagay.2bf      0.129 0.139 0.371 0.218 0.406 0.005 0.584
##                                [8]
## [1] MEC.Coquimbo.Bilagay.2bf 0.871
## [2] MEC.Taltal.Bilagay.2bf   0.861
## [3] MEL.COL.Bilagay.2bf      0.629
## [4] MEL.CHI.Bilagay.2bf      0.782
## [5] MEL.RIN.Bilagay.2bf      0.594
## [6] Fondecyt.ISM.Bilagay.2bf 0.995
## [7] MEL.LAG.Bilagay.2bf      0.416
## [8] MEL.LOB.Bilagay.2bf      0.000</code></pre>
</div>
<div id="parallel-trophic-position" class="section level2">
<h2>Parallel trophic position</h2>
<p>As an appendix, we will estimate trophic position using parallel calculations. We will use the library <code>parallel</code> that comes with base R. First we have to create a parallel socket cluster, i.e. to create a set of copies of R running in parallel. This is done with the function <code>makePSOCKcluster()</code> and detecting the number of cores with <code>detectCores()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cl &lt;-<span class="st"> </span>parallel::<span class="kw">makePSOCKcluster</span>(parallel::<span class="kw">detectCores</span>())</code></pre></div>
<p>Then we will use the function <code>parLapply()</code>. This function is a parallel version of <code>lapply()</code> a function that applies a function over a list. As we coded <code>tRophicPosition</code> specifically to use lists, we can calculate the trophic position for a number of species in parallel rather in series. As we are just comparing the performance of the serial vs parallel version of multiModelTP, we will use just 500 adaptive iterations and 500 actual iterations after discarding 500 iterations as burnin:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># First we calculate the time elapsed with system.time() with parallel</span>
time_parallel &lt;-<span class="st"> </span><span class="kw">system.time</span>(a &lt;-<span class="st"> </span>parallel::<span class="kw">parLapply</span>(cl, BilagayList, multiModelTP, 
                                               <span class="dt">adapt =</span> <span class="dv">500</span>, <span class="dt">n.iter =</span> <span class="dv">500</span>,
                                               <span class="dt">burnin =</span> <span class="dv">500</span>))

<span class="co"># Then we calculate the elapsed time with the normal version</span>
time_serial &lt;-<span class="st"> </span><span class="kw">system.time</span>(b &lt;-<span class="st"> </span><span class="kw">lapply</span>(BilagayList, multiModelTP, <span class="dt">quiet =</span> <span class="ot">TRUE</span>, 
                                               <span class="dt">adapt =</span> <span class="dv">500</span>, <span class="dt">n.iter =</span> <span class="dv">500</span>,
                                               <span class="dt">burnin =</span> <span class="dv">500</span>))

<span class="co"># We have to stop the cluster after each set of calculations</span>
parallel::<span class="kw">stopCluster</span>(cl)

<span class="co"># And print the elapsed time</span>
<span class="kw">print</span>(<span class="kw">rbind</span>(time_parallel, time_serial))</code></pre></div>
<pre><code>##               user.self sys.self elapsed user.child sys.child
## time_parallel     0.122    0.097  44.455      0.008     0.075
## time_serial      85.587    1.432  92.284      0.000     0.000</code></pre>
<p>Above you will see that in a modest MacBook Air (Intel Core i5, 1.6 GHz, 4 cores) the elapsed time with the serial version of <code>multiModelTP()</code> is roughly 92 seconds, while using the parallel version, the analysis time is reduced by almost 50 % (44 seconds), a not trivial difference. However, on desktop pc running Windows 10 (i7 3930-K, 3.2 GHz, 12 cores), the serial version took 73 seconds, while the parallel version took only 14 seconds.</p>
</div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
